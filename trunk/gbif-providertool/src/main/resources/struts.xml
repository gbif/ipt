<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE struts PUBLIC "-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
    "http://struts.apache.org/dtds/struts-2.0.dtd">

<struts>

	<!--
		Constants see struts.properties some constants, i.e. struts.locale
		dont work in struts.xml:
		http://issues.apache.org/struts/browse/WW-2068
	-->
	<!-- Configuration for the default package. -->
	<package name="default" extends="struts-default">
		<interceptors>
			<!-- Interceptor to handle allowing only admins to certain actions -->
			<interceptor name="adminOnly" class="adminInterceptor" />
			<interceptor name="managerOnly" class="managerInterceptor" />
			<interceptor name="resource-watcher" class="resourceInterceptor" />
			<interceptor name="i18n-custom" class="localeInterceptor" />

			<!--
				Copied from struts-default.xml, changed validation exclude methods
				plus added second params interceptor for preparable()
			-->
			<interceptor-stack name="defaultStack">
				<interceptor-ref name="exception" />
				<interceptor-ref name="alias" />
				<interceptor-ref name="params" />
				<interceptor-ref name="servlet-config" />
				<interceptor-ref name="prepare" />
				<!-- custom version of the struts i18n interceptor -->
				<interceptor-ref name="i18n-custom" />
				<interceptor-ref name="chain" />
				<interceptor-ref name="debugging" />
				<interceptor-ref name="profiling" />
				<interceptor-ref name="scoped-model-driven" />
				<interceptor-ref name="model-driven" />
				<!-- set to 100 meg -->
				<interceptor-ref name="fileUpload">
					<param name="maximumSize">104857600</param>
				</interceptor-ref>
				<interceptor-ref name="checkbox" />
				<interceptor-ref name="static-params" />
				<interceptor-ref name="params">
					<param name="excludeParams">dojo\..*</param>
				</interceptor-ref>
				<interceptor-ref name="conversionError" />
				<interceptor-ref name="validation">
					<param name="excludeMethods">cancel,execute,delete,edit,list,back,input</param>
				</interceptor-ref>
				<interceptor-ref name="workflow">
					<param name="excludeMethods">input,back,cancel,browse</param>
				</interceptor-ref>
			</interceptor-stack>
			<interceptor-stack name="fileUploadStack">
				<!-- set to 100 meg -->
				<interceptor-ref name="fileUpload">
					<param name="maximumSize">104857600</param>
				</interceptor-ref>
				<interceptor-ref name="defaultStack" />
			</interceptor-stack>
			<interceptor-stack name="resourceStack">
				<interceptor-ref name="resource-watcher" />
				<interceptor-ref name="defaultStack" />
			</interceptor-stack>
			<interceptor-stack name="adminStack">
				<interceptor-ref name="resourceStack" />
				<interceptor-ref name="adminOnly" />
			</interceptor-stack>
			<interceptor-stack name="managerStack">
				<interceptor-ref name="resourceStack" />
				<interceptor-ref name="managerOnly" />
			</interceptor-stack>
			<interceptor-stack name="portalStack">
				<interceptor-ref name="resource-watcher" />
				<interceptor-ref name="defaultStack" />
			</interceptor-stack>
		</interceptors>

		<default-action-ref name="index" />

		<global-results>
			<result name="resource-busy" type="redirect-action">
				<param name="actionName">busy</param>
				<param name="resourceId">${#parameters.resourceId}</param>
			</result>
			<!--
				appfuse actions use mainMenu to redirect to the application homepage
			-->
			<result name="mainMenu" type="redirect-action">/index</result>
			<result name="dataAccessFailure" type="freemarker">/WEB-INF/pages/dataAccessFailure.ftl
			</result>
			<result name="cancel" type="redirect">/</result>
		</global-results>

		<global-exception-mappings>
			<exception-mapping exception="org.springframework.dao.DataAccessException"
				result="dataAccessFailure" />
		</global-exception-mappings>


		<action name="login" class="org.gbif.provider.webapp.action.BaseAction">
			<result type="freemarker">/WEB-INF/pages/login.ftl</result>
		</action>
		<action name="logout" class="org.gbif.provider.webapp.action.LogoutAction">
			<result type="redirect-action">index</result>
		</action>
		<action name="denied" class="org.gbif.provider.webapp.action.BaseAction">
			<result type="freemarker">/WEB-INF/pages/denied.ftl</result>
		</action>

		<action name="signup" class="org.gbif.provider.webapp.action.SignupAction">
			<result name="cancel" type="redirect">/</result>
			<result name="input" type="freemarker">/WEB-INF/pages/signup.ftl</result>
			<result name="success" type="chain">saveSignup</result>
		</action>

		<action name="saveSignup" class="org.gbif.provider.webapp.action.SignupAction"
			method="save">
			<result name="input" type="freemarker">/WEB-INF/pages/signup.ftl</result>
			<result name="success" type="redirect-action">index</result>
		</action>

		<action name="editProfile" class="org.gbif.provider.webapp.action.UserAction"
			method="edit">
			<result name="input">/WEB-INF/pages/userForm.jsp</result>
			<result name="success">/WEB-INF/pages/userForm.jsp</result>
			<result name="error">/WEB-INF/pages/index.jsp</result>
		</action>
		<action name="saveUser" class="org.gbif.provider.webapp.action.UserAction"
			method="save">
			<result name="cancel" type="redirect-action">users</result>
			<result name="input">/WEB-INF/pages/userForm.jsp</result>
			<result name="success" type="redirect-action">index</result>
		</action>


		<action name="passwordHint"
			class="org.gbif.provider.webapp.action.PasswordHintAction">
			<result name="input">/</result>
			<result name="success">/</result>
		</action>

		<!-- Application Home -->
		<action name="index" class="org.gbif.provider.webapp.action.IndexAction">
			<result type="freemarker">/WEB-INF/pages/index.ftl</result>
		</action>

	</package>

	<package name="default-freemarker" namespace="/" extends="default">
		<result-types>
			<result-type name="freemarker"
				class="org.apache.struts2.views.freemarker.FreemarkerResult"
				default="true" />
		</result-types>

		<default-interceptor-ref name="defaultStack" />
	</package>


	<!-- Actions showing data to the public, anonymous users -->
	<package name="portal" namespace="/" extends="default-freemarker">
		<default-interceptor-ref name="portalStack" />

		<global-results>
			<result name="resource404" type="redirect-action">
				<param name="actionName">404</param>
			</result>
			<result name="record404" type="redirect-action">
				<param name="actionName">404</param>
				<param name="resourceId">${#parameters.resourceId}</param>
			</result>
		</global-results>

		<action name="404"
			class="org.gbif.provider.webapp.action.portal.NotFoundAction">
			<result name="resource404">/WEB-INF/pages/404resource.ftl</result>
			<result name="record404">/WEB-INF/pages/404record.ftl</result>
		</action>

		<!-- actions for all resources -->
		<action name="busy">
			<result>/WEB-INF/pages/busy.ftl</result>
			<result name="resource-busy">/WEB-INF/pages/busy.ftl</result>
		</action>
		<action name="search"
			class="org.gbif.provider.webapp.action.portal.ResourceAction" method="search">
			<result>/WEB-INF/pages/portal/meta/metaSearch.ftl</result>
			<result name="occ" type="redirect-action">
				<param name="actionName">occSearch</param>
				<param name="q">${q}</param>
				<param name="resourceId">${resource.id}</param>
			</result>
			<result name="tax" type="redirect-action">
				<param name="actionName">taxSearch</param>
				<param name="q">${q}</param>
				<param name="resourceId">${resource.id}</param>
			</result>
		</action>
		<!--
			forwarding actions for all resource types. Allows easy linking
			without knowing the type of resource
		-->
		<action name="resource"
			class="org.gbif.provider.webapp.action.portal.ResourceAction" method="forward">
			<result name="occ" type="redirect-action">
				<param name="actionName">occResource</param>
				<param name="resourceId">${resource.id}</param>
			</result>
			<result name="tax" type="redirect-action">
				<param name="actionName">taxResource</param>
				<param name="resourceId">${resource.id}</param>
			</result>
			<result name="meta" type="redirect-action">
				<param name="actionName">metaResource</param>
				<param name="resourceId">${resource.id}</param>
			</result>
		</action>
		<action name="detail"
			class="org.gbif.provider.webapp.action.portal.ResourceAction" method="forward">
			<result name="occ" type="redirect-action">
				<param name="actionName">occDetail</param>
				<param name="resourceId">${resource.id}</param>
				<param name="guid">${guid}</param>
			</result>
			<result name="tax" type="redirect-action">
				<param name="actionName">taxDetail</param>
				<param name="resourceId">${resource.id}</param>
				<param name="guid">${guid}</param>
			</result>
		</action>
		<action name="eml"
			class="org.gbif.provider.webapp.action.portal.DataAction" method="eml">
			<result name="success" type="stream">
				<param name="contentType">text/xml</param>
				<param name="inputName">inputStream</param>
				<param name="contentDisposition">filename="eml.xml"</param>
				<param name="bufferSize">1024</param>
			</result>
		</action>
		<action name="archive"
			class="org.gbif.provider.webapp.action.portal.DataAction">
			<result name="success" type="stream">
				<param name="contentType">application/zip</param>
				<param name="inputName">inputStream</param>
				<param name="contentDisposition">filename="archive.zip"</param>
				<param name="bufferSize">1024</param>
			</result>
		</action>
		<action name="logo"
			class="org.gbif.provider.webapp.action.portal.DataAction" method="logo">
			<result name="success" type="stream">
				<param name="contentType">image/jpeg</param>
				<param name="inputName">inputStream</param>
				<param name="contentDisposition">filename="logo.jpg"</param>
				<param name="bufferSize">1024</param>
			</result>
		</action>



		<!-- annotations -->
		<action name="annotations"
			class="org.gbif.provider.webapp.action.portal.AnnotationAction"
			method="list">
			<result>/WEB-INF/pages/portal/annotationList.ftl</result>
		</action>
		<action name="annotation"
			class="org.gbif.provider.webapp.action.portal.AnnotationAction">
			<result>/WEB-INF/pages/portal/annotationList.ftl</result>
		</action>


		<!-- metadata actions -->
		<action name="metaResource"
			class="org.gbif.provider.webapp.action.portal.ResourceAction">
			<result>/WEB-INF/pages/portal/meta/resource.ftl</result>
		</action>
		<action name="geoSearch"
			class="org.gbif.provider.webapp.action.portal.ResourceAction" method="geoSearch">
			<result>/WEB-INF/pages/portal/meta/metaSearch.ftl</result>
		</action>
		<action name="resources"
			class="org.gbif.provider.webapp.action.portal.ResourceAction" method="list">
			<result>/WEB-INF/pages/portal/meta/resourceList.ftl</result>
		</action>
		<action name="atom"
			class="org.gbif.provider.webapp.action.portal.ResourceAction" method="rss">
			<result name="success" type="freemarker">
				<param name="location">/WEB-INF/pages/portal/atom.ftl</param>
				<param name="contentType">text/xml</param>
			</result>
		</action>
		<action name="rss"
			class="org.gbif.provider.webapp.action.portal.ResourceAction" method="rss">
			<result name="success" type="freemarker">
				<param name="location">/WEB-INF/pages/portal/rss.ftl</param>
				<param name="contentType">text/xml</param>
			</result>
		</action>


		<!-- occurrence actions -->
		<action name="occResource"
			class="org.gbif.provider.webapp.action.portal.OccResourceAction">
			<result>/WEB-INF/pages/portal/occ/index.ftl</result>
		</action>
		<action name="occResourceStatsBy*"
			class="org.gbif.provider.webapp.action.portal.OccResourceStatsAction"
			method="statsBy{1}">
			<param name="zoom">true</param>
			<param name="title">true</param>
			<param name="statsBy">{1}</param>
			<param name="resourceClass">occ</param>
			<result name="pie">/WEB-INF/pages/portal/stats.ftl</result>
			<result name="map">/WEB-INF/pages/portal/mapstats.ftl</result>
			<result name="chart">/WEB-INF/pages/portal/stats.ftl</result>
		</action>
		<action name="occTaxon"
			class="org.gbif.provider.webapp.action.portal.TaxonAction" method="occurrences">
			<result>/WEB-INF/pages/portal/occ/taxon.ftl</result>
		</action>
		<action name="occRegion"
			class="org.gbif.provider.webapp.action.portal.RegionAction" method="occurrences">
			<result>/WEB-INF/pages/portal/occ/region.ftl</result>
		</action>
		<action name="occDetail" class="org.gbif.provider.webapp.action.portal.DwcAction">
			<result>/WEB-INF/pages/portal/occ/occurrence.ftl</result>
			<result name="xml">
				<param name="location">/WEB-INF/pages/portal/occ/xmlDetail.ftl</param>
				<param name="contentType">text/xml</param>
			</result>
			<result name="json">
				<param name="location">/WEB-INF/pages/missing.ftl</param>
				<param name="contentType">text/json</param>
			</result>
		</action>
		<action name="occSearch" class="org.gbif.provider.webapp.action.portal.DwcAction"
			method="search">
			<result>/WEB-INF/pages/portal/occ/occSearch.ftl</result>
		</action>


		<!-- checklist actions -->
		<action name="taxResource"
			class="org.gbif.provider.webapp.action.portal.TaxResourceAction">
			<result>/WEB-INF/pages/portal/tax/index.ftl</result>
		</action>
		<action name="taxDetail"
			class="org.gbif.provider.webapp.action.portal.TaxonAction">
			<result>/WEB-INF/pages/portal/tax/taxon.ftl</result>
			<result name="xml">
				<param name="location">/WEB-INF/pages/portal/tax/xmlDetail.ftl</param>
				<param name="contentType">text/xml</param>
			</result>
			<result name="rdf">
				<param name="location">/WEB-INF/pages/portal/tax/rdfDetail.ftl</param>
				<param name="contentType">text/rdf</param>
			</result>
			<result name="json">
				<param name="location">/WEB-INF/pages/missing.ftl</param>
				<param name="contentType">text/json</param>
			</result>
		</action>
		<action name="taxSearch"
			class="org.gbif.provider.webapp.action.portal.TaxonAction" method="search">
			<result>/WEB-INF/pages/portal/tax/taxSearch.ftl</result>
		</action>
		<action name="taxResourceStatsBy*"
			class="org.gbif.provider.webapp.action.portal.TaxResourceStatsAction"
			method="statsBy{1}">
			<param name="zoom">true</param>
			<param name="title">true</param>
			<param name="statsBy">{1}</param>
			<param name="resourceClass">tax</param>
			<result name="pie">/WEB-INF/pages/portal/stats.ftl</result>
			<result name="map">/WEB-INF/pages/portal/mapstats.ftl</result>
			<result name="chart">/WEB-INF/pages/portal/stats.ftl</result>
		</action>
		<action name="taxListBy*"
			class="org.gbif.provider.webapp.action.portal.TaxonAction" method="listBy{1}">
			<param name="action">{1}</param>
			<result>/WEB-INF/pages/portal/tax/taxonList.ftl</result>
		</action>

	</package>

	<!-- undecorated AJAX calls needed by the portal -->
	<package name="ajax" namespace="/ajax" extends="default-freemarker">
		<action name="occResourceStatsBy*"
			class="org.gbif.provider.webapp.action.portal.OccResourceStatsAction"
			method="statsBy{1}">
			<param name="statsBy">{1}</param>
			<param name="resourceClass">occ</param>
			<result name="pie">/WEB-INF/pages/ajax/chartimg.ftl</result>
			<result name="map">/WEB-INF/pages/ajax/chartimg.ftl</result>
			<result name="chart">/WEB-INF/pages/ajax/chartimg.ftl</result>
		</action>
		<action name="taxResourceStatsBy*"
			class="org.gbif.provider.webapp.action.portal.TaxResourceStatsAction"
			method="statsBy{1}">
			<param name="statsBy">{1}</param>
			<param name="resourceClass">tax</param>
			<result name="pie">/WEB-INF/pages/ajax/chartimg.ftl</result>
			<result name="map">/WEB-INF/pages/ajax/chartimg.ftl</result>
			<result name="chart">/WEB-INF/pages/ajax/chartimg.ftl</result>
		</action>

		<action name="publish"
			class="org.gbif.provider.webapp.action.manage.MetadataAction" method="publish">
			<result>/WEB-INF/pages/ajax/publish.ftl</result>
		</action>

		<action name="resourceStatus"
			class="org.gbif.provider.webapp.action.manage.ImportAction" method="status">
			<result name="resource-busy">/WEB-INF/pages/ajax/status.ftl</result>
			<result name="resource-ready">/WEB-INF/pages/ajax/status.ftl</result>
		</action>
		<action name="taxonTree"
			class="org.gbif.provider.webapp.action.portal.TaxonTreeAction">
			<result>
				<param name="location">/WEB-INF/pages/ajax/treej.ftl</param>
				<param name="contentType">text/json</param>
			</result>
		</action>
		<action name="taxonSubTree"
			class="org.gbif.provider.webapp.action.portal.TaxonTreeAction"
			method="subNodes">
			<result>
				<param name="location">/WEB-INF/pages/ajax/treej.ftl</param>
				<param name="contentType">text/json</param>
			</result>
		</action>
		<action name="regionTree"
			class="org.gbif.provider.webapp.action.portal.RegionTreeAction">
			<result>
				<param name="location">/WEB-INF/pages/ajax/treej.ftl</param>
				<param name="contentType">text/json</param>
			</result>
		</action>
		<action name="regionSubTree"
			class="org.gbif.provider.webapp.action.portal.RegionTreeAction"
			method="subNodes">
			<result>
				<param name="location">/WEB-INF/pages/ajax/treej.ftl</param>
				<param name="contentType">text/json</param>
			</result>
		</action>
		<action name="sourcePreview"
			class="org.gbif.provider.webapp.action.manage.SourceAction" method="sourcePreview">
			<result>/WEB-INF/pages/ajax/preview.ftl</result>
		</action>
		<action name="uploadPreview"
			class="org.gbif.provider.webapp.action.manage.SourceAction" method="sourcePreview">
			<result>/WEB-INF/pages/ajax/preview.ftl</result>
		</action>
		<action name="propVocabulary"
			class="org.gbif.provider.webapp.action.manage.VocabularyAction">
			<result>/WEB-INF/pages/ajax/propVocabulary.ftl</result>
		</action>
		<action name="vocSelect"
			class="org.gbif.provider.webapp.action.manage.VocabularyAction"
			method="voc">
			<result>/WEB-INF/pages/ajax/vocSelect.ftl</result>
		</action>
		<action name="keywords"
			class="org.gbif.provider.webapp.action.portal.KeywordAction">
			<result>/WEB-INF/pages/ajax/keywords.ftl</result>
		</action>
		<action name="annotation"
			class="org.gbif.provider.webapp.action.portal.AnnotationAction"
			method="show">
			<result>/WEB-INF/pages/ajax/annotation.ftl</result>
		</action>

		<action name="proxy" class="org.gbif.provider.webapp.action.ProxyAction">
			<result type="stream">
				<param name="inputName">inputStream</param>
				<param name="bufferSize">1024</param>
			</result>
		</action>
		<action name="organisations" class="org.gbif.provider.webapp.action.ProxyAction"
			method="organisations">
			<result type="stream">
				<param name="inputName">inputStream</param>
				<param name="bufferSize">1024</param>
			</result>
		</action>

	</package>


	<!-- Base package for all managing packages  -->
	<package name="manage" namespace="/manage" extends="default-freemarker">
		<default-interceptor-ref name="managerStack" />
		<default-action-ref name="resources" />
		<global-results>
			<result name="resource404" type="redirect-action">
				<param name="actionName">404</param>
				<param name="namespace">/</param>
			</result>
			<result name="resource-busy" type="redirect-action">
				<param name="actionName">status</param>
				<param name="resourceId">${#parameters.resourceId}</param>
			</result>
			<result name="cancel" type="redirect-action">
				<param name="actionName">resource</param>
				<param name="resourceId">${#parameters.resourceId}</param>
			</result>
			<result name="error" type="redirect-action">resources</result>
		</global-results>

		<action name="createOrg"
			class="org.gbif.provider.webapp.action.manage.CreateOrgAction">
			<result type="freemarker">/WEB-INF/pages/manage/createOrg.ftl</result>
		</action>

		<action name="publishAll"
			class="org.gbif.provider.webapp.action.manage.MetadataAction" method="publishAll">
			<result>/WEB-INF/pages/manage/resourceList.ftl</result>
		</action>
		<action name="resources"
			class="org.gbif.provider.webapp.action.manage.MetadataAction" method="list">
			<result>/WEB-INF/pages/manage/resourceList.ftl</result>
		</action>
		<action name="resource"
			class="org.gbif.provider.webapp.action.manage.MetadataAction">
			<result>/WEB-INF/pages/manage/metadata.ftl</result>
		</action>
		<!-- TODO 
        <action name="associatedParties"
            class="org.gbif.provider.webapp.action.manage.MetadataAction">
            <result>/WEB-INF/pages/manage/AssociatedParties.ftl</result>
        </action>
        -->		
		<action name="saveResource"
			class="org.gbif.provider.webapp.action.manage.MetadataAction" method="save">
			<result>/WEB-INF/pages/manage/metadata.ftl</result>
			<result name="input">/WEB-INF/pages/manage/metadata.ftl</result>
			<result name="occ" type="redirect-action">
				<param name="actionName">meta/organisation</param>
				<param name="resourceId">${resource.id}</param>
			</result>
			<result name="tax" type="redirect-action">
				<param name="actionName">sources</param>
				<param name="resourceId">${resource.id}</param>
			</result>
			<result name="meta" type="redirect-action">
				<param name="actionName">creatorForm</param>
				<param name="namespace">/manage/meta</param>
				<param name="resourceId">${resource.id}</param>
			</result>
			<result name="cancel" type="redirect-action">
				<param name="actionName">resources</param>
			</result>
			<result name="delete" type="redirect-action">resources</result>
		</action>

		<action name="sources"
			class="org.gbif.provider.webapp.action.manage.SourceAction" method="list">
			<result>/WEB-INF/pages/manage/sources.ftl</result>
		</action>
		<action name="uploadSource"
			class="org.gbif.provider.webapp.action.manage.SourceAction" method="upload">
			<result>/WEB-INF/pages/manage/sources.ftl</result>
			<result name="input">/WEB-INF/pages/manage/sources.ftl</result>
			<result name="error" type="redirect-action">
				<param name="actionName">sources</param>
				<param name="resourceId">${resource.id}</param>
			</result>
		</action>
		<action name="updateSourceFile"
			class="org.gbif.provider.webapp.action.manage.SourceAction" method="updateFile">
			<result type="redirect-action">
				<param name="actionName">sources</param>
				<param name="resourceId">${resource.id}</param>
			</result>
			<!-- added by tim -->
			<result name="delete" type="redirect-action">
				<param name="actionName">sources</param>
				<param name="resourceId">${resource.id}</param>
			</result>
		</action>
		<action name="editSource"
			class="org.gbif.provider.webapp.action.manage.SourceAction">
			<result>/WEB-INF/pages/manage/sourceSqlForm.ftl</result>
		</action>
		<action name="saveSource"
			class="org.gbif.provider.webapp.action.manage.SourceAction" method="save">
			<result name="input">/WEB-INF/pages/manage/sourceSqlForm.ftl</result>
			<result name="success" type="redirect-action">
				<param name="actionName">sources</param>
				<param name="resourceId">${resource.id}</param>
			</result>
			<result name="cancel" type="redirect-action">
				<param name="actionName">sources</param>
				<param name="resourceId">${resource.id}</param>
			</result>
			<result name="delete" type="redirect-action">
				<param name="actionName">sources</param>
				<param name="resourceId">${resource.id}</param>
			</result>
		</action>
		<action name="editConnection"
			class="org.gbif.provider.webapp.action.manage.MetadataAction" method="connection">
			<result>/WEB-INF/pages/manage/connectionForm.ftl</result>
		</action>
		<action name="saveConnection"
			class="org.gbif.provider.webapp.action.manage.MetadataAction" method="saveConnection">
			<result name="input">/WEB-INF/pages/manage/connectionForm.ftl</result>
			<result name="success" type="redirect-action">
				<param name="actionName">sources</param>
				<param name="resourceId">${resource.id}</param>
			</result>
			<result name="cancel" type="redirect-action">
				<param name="actionName">sources</param>
				<param name="resourceId">${resource.id}</param>
			</result>
		</action>

		<action name="transformations"
			class="org.gbif.provider.webapp.action.manage.TransformationAction">
			<result>/WEB-INF/pages/manage/transformations.ftl</result>
		</action>

		<action name="mappings"
			class="org.gbif.provider.webapp.action.manage.MappingAction">
			<result>/WEB-INF/pages/manage/mappings.ftl</result>
		</action>
		<action name="propMapping"
			class="org.gbif.provider.webapp.action.manage.PropertyMappingAction">
			<result>/WEB-INF/pages/manage/propertyMapping.ftl</result>
		</action>
		<action name="savePropertyMapping"
			class="org.gbif.provider.webapp.action.manage.PropertyMappingAction"
			method="save">
			<result name="input">/WEB-INF/pages/manage/propertyMapping.ftl
			</result>
			<result name="success" type="redirect-action">
				<param name="actionName">mappings</param>
				<param name="resourceId">${resourceId}</param>
			</result>
			<result name="cancel" type="redirect-action">
				<param name="actionName">mappings</param>
				<param name="resourceId">${resourceId}</param>
			</result>
			<result name="terms" type="redirect-action">
				<param name="actionName">terMapping</param>
				<param name="resourceId">${resourceId}</param>
				<param name="tid">${tid}</param>
				<param name="mid">${mid}</param>
			</result>
		</action>

		<action name="terMapping"
			class="org.gbif.provider.webapp.action.manage.TermMappingAction">
			<result>/WEB-INF/pages/manage/termMapping.ftl</result>
		</action>
		<action name="terMappingScan"
			class="org.gbif.provider.webapp.action.manage.TermMappingAction"
			method="scanSource">
			<result>/WEB-INF/pages/manage/termMapping.ftl</result>
		</action>
		<action name="saveTerMapping"
			class="org.gbif.provider.webapp.action.manage.TermMappingAction"
			method="save">
			<result name="input" type="freemarker">/WEB-INF/pages/manage/termMapping.ftl
			</result>
			<result name="success" type="redirect-action">
				<param name="actionName">${origin}</param>
				<param name="resourceId">${resourceId}</param>
				<param name="tid">${tid}</param>
				<param name="mid">${mid}</param>
			</result>
			<result name="cancel" type="redirect-action">
				<param name="actionName">${origin}</param>
				<param name="resourceId">${resourceId}</param>
				<param name="tid">${tid}</param>
				<param name="mid">${mid}</param>
			</result>
		</action>

		<action name="cache"
			class="org.gbif.provider.webapp.action.manage.ImportAction">
			<result>/WEB-INF/pages/manage/cache.ftl</result>
		</action>
		<action name="runImport"
			class="org.gbif.provider.webapp.action.manage.ImportAction" method="upload">
			<result type="redirect-action">
				<param name="actionName">status</param>
				<param name="resourceId">${resourceId}</param>
			</result>
		</action>
		<action name="cancelUpload"
			class="org.gbif.provider.webapp.action.manage.ImportAction" method="cancel">
			<result name="success" type="redirect-action">
				<param name="actionName">resource</param>
				<param name="resourceId">${resourceId}</param>
			</result>
		</action>
		<action name="status"
			class="org.gbif.provider.webapp.action.manage.ImportAction" method="status">
			<result name="resource-busy">/WEB-INF/pages/manage/uploadStatus.ftl</result>
			<result name="resource-ready" type="redirect-action">
				<param name="actionName">resource</param>
				<param name="namespace">/</param>
				<param name="resourceId">${resourceId}</param>
			</result>
		</action>

		<action name="validation"
			class="org.gbif.provider.webapp.action.manage.MetadataAction">
			<result>/WEB-INF/pages/manage/validation.ftl</result>
		</action>

		<action name="history"
			class="org.gbif.provider.webapp.action.manage.ImportAction" method="history">
			<result>/WEB-INF/pages/manage/uploadHistory.ftl</result>
		</action>

	</package>


	<!-- Actions managing generic resources  -->
	<package name="metadata" namespace="/manage/meta" extends="default-freemarker">
		<default-interceptor-ref name="managerStack" />
		<default-action-ref name="resources" />
		<global-results>
			<result name="cancel" type="redirect-action">
				<param name="actionName">resource</param>
				<param name="namespace">/manage</param>
				<param name="resourceId">${#parameters.resourceId}</param>
			</result>
			<result name="error" type="redirect-action">
				<param name="actionName">resource</param>
				<param name="namespace">/manage</param>
				<param name="resourceId">${#parameters.resourceId}</param>
			</result>
		</global-results>


		<action name="resources">
			<result type="redirect-action">
				<param name="actionName">resources</param>
				<param name="namespace">/manage</param>
				<param name="resourceType">meta</param>
			</result>
		</action>

		<action name="*Form"
			class="org.gbif.provider.webapp.action.manage.EmlEditorAction">
			<result type="freemarker">/WEB-INF/pages/manage/meta/{1}.ftl</result>
			<result name="input" type="freemarker">/WEB-INF/pages/manage/meta/{1}.ftl
			</result>
		</action>
		<!-- the last action in the EML editing workflow -->
		<action name="additionalMetadata"
			class="org.gbif.provider.webapp.action.manage.EmlEditorAction"
			method="save">
			<result name="input" type="freemarker">/WEB-INF/pages/manage/meta/additionalMetadata.ftl
			</result>
			<result name="success" type="redirect-action">
				<param name="actionName">resource</param>
				<param name="namespace">/manage</param>
				<param name="resourceId">${#parameters.resourceId}</param>
			</result>
		</action>
		<action name="*"
			class="org.gbif.provider.webapp.action.manage.EmlEditorAction"
			method="save">
			<result name="back" type="redirect-action">
				<param name="actionName">${backPage}Form</param>
				<param name="resourceId">${#parameters.resourceId}</param>
			</result>
			<result name="input" type="freemarker">/WEB-INF/pages/manage/meta/{1}.ftl
			</result>
			<result name="success" type="redirect-action">
				<param name="actionName">${nextPage}Form</param>
				<param name="resourceId">${#parameters.resourceId}</param>
			</result>
		</action>

	</package>


	<!-- Actions in this package will be prefixed with /admin/ -->
	<package name="admin" extends="default" namespace="/admin">
		<default-interceptor-ref name="adminStack" />
		<global-results>
			<result name="cancel" type="redirect">/index.html</result>
			<result name="error" type="redirect">/index.html</result>
			<result name="resource404" type="redirect-action">
				<param name="actionName">404</param>
				<param name="namespace">/</param>
			</result>
		</global-results>

		<action name="users" class="org.gbif.provider.webapp.action.UserAction"
			method="list">
			<result>/WEB-INF/pages/admin/userList.jsp</result>
		</action>
		<action name="editUser" class="org.gbif.provider.webapp.action.UserAction"
			method="edit">
			<result name="success">/WEB-INF/pages/userForm.jsp</result>
			<result name="input">/WEB-INF/pages/admin/userList.jsp</result>
		</action>
		<action name="saveUser" class="org.gbif.provider.webapp.action.UserAction"
			method="save">
			<result name="cancel" type="redirect-action">users</result>
			<result name="input">/WEB-INF/pages/userForm.jsp</result>
			<result name="success" type="redirect-action">users</result>
		</action>

		<action name="config"
			class="org.gbif.provider.webapp.action.admin.ConfigAction">
			<result type="freemarker">/WEB-INF/pages/admin/config.ftl</result>
		</action>
		<action name="configOrg"
			class="org.gbif.provider.webapp.action.admin.ConfigOrgAction">
			<result type="freemarker">/WEB-INF/pages/admin/configOrg.ftl</result>
		</action>
		<action name="configIpt"
			class="org.gbif.provider.webapp.action.admin.ConfigIptAction">
			<result type="freemarker">/WEB-INF/pages/admin/configIpt.ftl</result>
		</action>


		<!-- EXTENSIONS -->
		<action name="extensions"
			class="org.gbif.provider.webapp.action.admin.ExtensionAction" method="list">
			<result type="freemarker">/WEB-INF/pages/admin/extensionList.ftl</result>
		</action>
		<action name="extension"
			class="org.gbif.provider.webapp.action.admin.ExtensionAction">
			<result type="freemarker">/WEB-INF/pages/admin/extension.ftl</result>
		</action>
		<action name="addExtension"
			class="org.gbif.provider.webapp.action.admin.ExtensionAction" method="add">
			<result type="redirect-action">
				<param name="actionName">extensions</param>
			</result>
		</action>
		<action name="delExtension"
			class="org.gbif.provider.webapp.action.admin.ExtensionAction" method="remove">
			<result type="redirect-action">
				<param name="actionName">extensions</param>
			</result>
		</action>
		<action name="synchroniseExtensions"
			class="org.gbif.provider.webapp.action.admin.ExtensionAction" method="synchroniseAll">
			<result type="redirect-action">
				<param name="actionName">extensions</param>
			</result>
		</action>

		<!-- VOCABULARIES -->
		<action name="vocabularies"
			class="org.gbif.provider.webapp.action.admin.ThesaurusAction" method="list">
			<result type="freemarker">/WEB-INF/pages/admin/vocabularyList.ftl</result>
		</action>
		<action name="vocabulary"
			class="org.gbif.provider.webapp.action.admin.ThesaurusAction">
			<result type="freemarker">/WEB-INF/pages/admin/vocabulary.ftl</result>
		</action>
		<action name="vocabularyExport"
			class="org.gbif.provider.webapp.action.admin.ThesaurusAction">
			<result type="freemarker">
				<param name="location">/WEB-INF/pages/admin/vocabularyExport.ftl</param>
				<param name="contentType">text/xml</param>
			</result>
		</action>
		<action name="concept"
			class="org.gbif.provider.webapp.action.admin.ThesaurusAction" method="concept">
			<result type="freemarker">/WEB-INF/pages/admin/concept.ftl</result>
		</action>
		<action name="synchroniseThesauri"
			class="org.gbif.provider.webapp.action.admin.ThesaurusAction" method="synchroniseAll">
			<result type="redirect-action">
				<param name="actionName">vocabularies</param>
			</result>
		</action>

		<!-- RESOURCES -->
		<action name="resources"
			class="org.gbif.provider.webapp.action.admin.MetadataAction" method="list">
			<result type="freemarker">/WEB-INF/pages/admin/resourceList.ftl</result>
		</action>		
		<action name="resource"
			class="org.gbif.provider.webapp.action.admin.MetadataAction">
			<result type="freemarker">/WEB-INF/pages/admin/resourceForm.ftl</result>
		</action>
		<action name="saveResource"
			class="org.gbif.provider.webapp.action.admin.MetadataAction" method="save">
			<result type="redirect-action">resources</result>
			<result name="cancel" type="redirect-action">resources</result>
			<result name="input" type="freemarker">/WEB-INF/pages/admin/resourceForm.ftl
			</result>
		</action>

	</package>

	<!-- TAPIR Actions -->
	<package name="tapir" namespace="/tapir" extends="default-freemarker">
		<default-interceptor-ref name="portalStack" />

		<action name="service"
			class="org.gbif.provider.webapp.action.tapir.TapirAction">
			<result name="ping">
				<param name="location">/WEB-INF/pages/tapir/ping.ftl</param>
				<param name="contentType">text/xml</param>
			</result>
			<result name="metadata">
				<param name="location">/WEB-INF/pages/tapir/metadata.ftl</param>
				<param name="contentType">text/xml</param>
			</result>
			<result name="capabilities">
				<param name="location">/WEB-INF/pages/tapir/capabilities.ftl</param>
				<param name="contentType">text/xml</param>
			</result>
			<result name="inventory">
				<param name="location">/WEB-INF/pages/tapir/inventory.ftl</param>
				<param name="contentType">text/xml</param>
			</result>
			<result name="search">
				<param name="location">/WEB-INF/pages/tapir/search.ftl</param>
				<param name="contentType">text/xml</param>
			</result>
			<result name="error">
				<param name="location">/WEB-INF/pages/tapir/error.ftl</param>
				<param name="contentType">text/xml</param>
			</result>
		</action>
	</package>

</struts>
