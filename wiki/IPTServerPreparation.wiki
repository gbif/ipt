#IPT server preparation considerations for various environments

This section contains information about IPT installations that may vary between operating systems or servlet containers.  

*Topics*
<wiki:toc max_depth="2" />

==Tomcat==

The IPT has been tested and works well with Tomcat 5.5, Tomcat 6.0 and Tomcat 7.0. The Apache Tomcat documentation can be found on http://tomcat.apache.org/. Also, minimal instructions for Tomcat installations on various operating systems can be found in associated Server Preparation pages: 

[Install Tomcat on Mac OS X]

Download the ipt.war file of the latest release of the IPT from http://code.google.com/p/gbif-providertoolkit/downloads/list. Copy the ipt.war file to the Tomcat webapps folder and then start Tomcat, or restart Tomcat if it is already running. You can then invoke the IPT in a web browser running on the same server by using the following URL:

http://localhost:8080/ipt

If the installation doesn't start please check the catalina.out logfile.  If you see the message 
`Provider org.apache.xalan.processor.TransformerFactoryImpl not found`
the chances are good that you are running Tomcat 5.x under Java 1.6 and are getting a conflict in your xml parsing libraries.  Look in ${catalina.home}/common/endorsed and remove any jars named like jaxp_parser_impl.jar and xml-common-apis.jar.  Then restart Tomcat and you should be ready to go.

==Apache reverse proxy to Tomcat==

If you wish to use Apache to proxy requests to Tomcat (because, for instance, your firewall blocks port 8080 and Apache is already running on port 80), you need to ensure that the cookies that Tomcat sets are handled correctly.  If you've followed the directions above for setting up Tomcat you would need the following lines as part of your Virtual Host declaration in Apache:

	`ProxyPreserveHost On`<br/>
	`ProxyPass / http://localhost:8080/ipt/`<br/>
	`ProxyPassReverse / http://localhost:8080/ipt/`<br/>
	`ProxyPassReverseCookiePath /ipt /`<br/>

And, make sure that the proxy and proxy_http modules have been loaded into Apache.

==Jetty==

The IPT comes equipped with a Jetty web server and servlet container. The IPT can be launched using Jetty if you have Java 5 (minimum), Maven, and Subversion installed (Mac OSX comes with all of these installed by default). 

First, change the working directory to the location where you would like to put the IPT source code. Then issue the following commands:

`$ svn checkout http://gbif-providertoolkit.googlecode.com/svn/trunk/gbif-ipt`<br>
`$ cd gbif-ipt`<br>
`$ mvn`<br>

The last "mvn" command should start the IPT with a local jetty instance on port 7001. Please note, this launches the IPT in testing mode, meaning that the checkbox "Production use" will be grayed out on Setup page II and registrations will be against the test registry "http://gbrdsdev.gbif.org" and not the live registry "http://gbrds.gbif.org".

To run in production mode, in place of the last "mvn" command use:

`$ mvn -P release`<br>

This makes the checkbox "Production use" on Setup page II appear. It must be checked obviously to run in production. What this means is that registrations will be against the live registry "http://gbrds.gbif.org" and not the test registry "http://gbrdsdev.gbif.org",

Either way, you can then invoke the IPT in a web browser using the following URL :

http://localhost:7001/ipt

The first time the mvn command is run it will download many libraries and may take a long time, depending on the Internet data transfer rate. After this has been done once it will be it will be fairly fast thereafter, even if you update to the latest trunk again, which can be done by issuing the following commands from the root directory of the IPT source code:

`$ cd gbif-ipt`<br>
`$ svn up`<br>
 