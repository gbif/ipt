#summary IPT server preparation considerations for various environments

=How To Prepare Your IPT Server = 

<wiki:toc max_depth="3" />

==Introduction==

Since the IPT ships as a .war file, installing the IPT consists of deploying the .war file in a servlet container such as Tomcat. 

This page explains how to install different types of servlet containers on your server, and how to deploy the IPT in them.

It isn't necessary to use an Apache reverse proxy, but in case you do, this page also explains how to configure an Apache virtual host declaration for the IPT.

==Servlet Containers== 

The most common servlet containers used to deploy the IPT are Tomcat, Jetty, and Wildfly8 (JBoss). Information about how to deploy the IPT in these servlets follows.

===Tomcat===

The IPT has been tested and works well with Tomcat 5.5, Tomcat 6.0 and Tomcat 7.0. The Apache Tomcat documentation can be found on http://tomcat.apache.org/. Also, minimal instructions for Tomcat installations on various operating systems can be found in associated Server Preparation pages: 

 * [TomcatInstallationMacOSX Tomcat on Mac OS X]
 * [TomcatInstallationWindows7 Tomcat on Windows 7]
 * [TomcatInstallationCentOS Tomcat on Cent OS 5]

Download the ipt.war file of the latest release of the IPT from http://www.gbif.org/ipt or from http://code.google.com/p/gbif-providertoolkit/. Copy the ipt.war file to the Tomcat webapps folder and then start Tomcat, or restart Tomcat if it is already running. You can then invoke the IPT in a web browser running on the same server by using the following URL:

http://localhost:8080/ipt

If the installation doesn't start please check the catalina.out logfile, and refer to the [FAQ] for help.

The following screencast also explains how to install the IPT using Tomcat, assuming Tomcat has already been installed.

<wiki:gadget url="https://gbif-providertoolkit.googlecode.com/svn/trunk/gbif-ipt-docs/ipt2/v22/vimeoSupport/gcVideo.xml" up_video="https://vimeo.com/116142276" width="640" height="384"/>

===Jetty===

The IPT comes equipped with a Jetty web server and servlet container. The IPT can be launched using Jetty if you have Java 6 (minimum), Maven, and Subversion installed (Mac OSX comes with all of these installed by default). 

First, change the working directory to the location where you would like to put the IPT source code. Then issue the following commands (please check if 2.1.1 is still the latest stable version):

`$ svn checkout http://gbif-providertoolkit.googlecode.com/svn/tags/ipt-2.1.1 gbif-ipt`<br>
`$ cd gbif-ipt`<br>
`$ mvn -Dmaven.test.skip=true`<br>

The last "mvn" command should start the IPT with a local jetty instance on port 8080. Please note, this launches the IPT in testing mode, meaning that the checkbox "Production use" will be grayed out on Setup page II and registrations will be against the test registry "http://gbrdsdev.gbif.org" and not the live registry "http://gbrds.gbif.org".

To run in production mode, in place of the last "mvn" command use:

`$ mvn -Dmaven.test.skip=true -P release`<br>

This makes the checkbox "Production use" on Setup page II appear. It must be checked obviously to run in production. What this means is that registrations will be against the live registry "http://gbrds.gbif.org" and not the test registry "http://gbrdsdev.gbif.org",

Either way, you can then invoke the IPT in a web browser using the following URL :

http://localhost:8080/ipt

The first time the mvn command is run it will download many libraries and may take a long time, depending on the Internet data transfer rate. After this has been done once it will be it will be fairly fast thereafter, even if you update to the latest trunk again, which can be done by issuing the following commands from the root directory of the IPT source code:

`$ cd gbif-ipt`<br>
`$ svn up`<br>

===Wildfly8 (JBoss)===

Instructions pending.

==Apache reverse proxy==

If you wish to use Apache to proxy requests for example to Tomcat (because, for instance, your firewall blocks port 8080 and Apache is already running on port 80), you need to ensure that the cookies that Tomcat sets are handled correctly.  

The virtual host http://ipt.gbif-uat.org/ has requests going through an Apache reverse proxy to an IPT deployed in Tomcat available at http://apps.gbif-uat.org:8080/ipt/ with no Tomcat Host defined. Here are the mod_proxy directives used:

{{{
<VirtualHost *:80>
    ServerName  ipt.gbif-uat.org
    ProxyPreserveHost       On
    ProxyPass               /       http://apps.gbif-uat.org:8080/ipt/
    ProxyPassReverse        /       http://apps.gbif-uat.org:8080/ipt/
    ProxyPassReverseCookiePath  /ipt /
</VirtualHost>
}}}

Don't forget that the proxy and proxy_http modules have been loaded into Apache.
 